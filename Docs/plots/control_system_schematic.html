<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Control System Schematic — Combined FF+FB</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #f0f1f5; display: flex; justify-content: center; padding: 24px; min-height: 100vh; }
  .container { max-width: 1640px; width: 100%; background: #fff; border-radius: 6px; box-shadow: 0 2px 20px rgba(0,0,0,0.08); overflow: hidden; }
  svg { display: block; width: 100%; height: auto; }
</style>
</head>
<body>
<div class="container">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1640 1000" font-family="'Georgia','Times New Roman',serif">
  <defs>
    <marker id="arr" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#1a1a2e"/></marker>
    <marker id="arr-r" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#b33"/></marker>
    <marker id="arr-b" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#1558a8"/></marker>
    <marker id="arr-g" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#2e7d32"/></marker>
    <marker id="arr-o" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#c67700"/></marker>
    <marker id="arr-p" markerWidth="9" markerHeight="6" refX="9" refY="3" orient="auto"><polygon points="0 0,9 3,0 6" fill="#7b1fa2"/></marker>
  </defs>

  <!-- ======== BACKGROUND ======== -->
  <rect width="1640" height="1000" fill="#fdfdff"/>

  <!-- ======== TITLE BAR ======== -->
  <rect x="0" y="0" width="1640" height="50" fill="#1a1a2e"/>
  <text x="30" y="33" fill="#fff" font-size="18.5" font-weight="bold" letter-spacing="0.7">COMBINED FEEDFORWARD + FEEDBACK ATTITUDE CONTROL SYSTEM</text>
  <text x="1610" y="33" fill="#7b8fad" font-size="11" text-anchor="end" font-style="italic">Flexible Spacecraft · MRP Formulation</text>
  <rect x="0" y="50" width="1640" height="22" fill="#252545" opacity="0.9"/>
  <text x="30" y="66" fill="#99aac8" font-size="10" letter-spacing="0.3">Plant: G(s) = 1/(4Is²) + Σ flex modes  ·  Controller: C(s) selectable PD / Filtered PD / Notch  ·  Actuators: 3 Reaction Wheels (pyramid)  ·  Attitude: Modified Rodrigues Parameters</text>

  <!-- ======== SECTION LABELS ======== -->
  <text x="200" y="100" fill="#b33" font-size="12" font-weight="bold" opacity="0.85">FEEDFORWARD PATH (open-loop)</text>
  <text x="200" y="298" fill="#1558a8" font-size="12" font-weight="bold" opacity="0.85">FEEDBACK PATH (closed-loop)</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--                  FEEDFORWARD PATH  (y ≈ 155)                -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- A ─ Maneuver Command -->
  <rect x="40" y="118" width="132" height="56" rx="4" fill="#fff5f4" stroke="#b33" stroke-width="1.6"/>
  <text x="106" y="142" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">Maneuver</text>
  <text x="106" y="160" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">Command</text>

  <!-- A → B -->
  <line x1="172" y1="146" x2="224" y2="146" stroke="#b33" stroke-width="1.8" marker-end="url(#arr-r)"/>
  <text x="198" y="140" text-anchor="middle" fill="#b33" font-size="9" font-style="italic">θ<tspan font-size="7" dy="2">f</tspan><tspan dy="-2">,ê</tspan></text>

  <!-- B ─ Trajectory Generator -->
  <rect x="224" y="112" width="172" height="68" rx="4" fill="#fff5f4" stroke="#b33" stroke-width="1.6"/>
  <text x="310" y="136" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">Trajectory</text>
  <text x="310" y="152" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">Generator</text>
  <text x="310" y="172" text-anchor="middle" fill="#777" font-size="8.5" font-style="italic">θ(t), ω(t), α(t)</text>

  <!-- B → C -->
  <line x1="396" y1="146" x2="450" y2="146" stroke="#b33" stroke-width="1.8" marker-end="url(#arr-r)"/>
  <text x="423" y="139" text-anchor="middle" fill="#b33" font-size="9" font-style="italic">α(t)</text>

  <!-- C ─ Input Shaper -->
  <rect x="450" y="118" width="150" height="56" rx="4" fill="#fff5f4" stroke="#b33" stroke-width="1.6"/>
  <text x="525" y="142" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">Input Shaper</text>
  <text x="525" y="160" text-anchor="middle" fill="#777" font-size="8.5" font-style="italic">τ̃ = Σ Aᵢ · τ(t − tᵢ)</text>

  <!-- C → D -->
  <line x1="600" y1="146" x2="654" y2="146" stroke="#b33" stroke-width="1.8" marker-end="url(#arr-r)"/>
  <text x="627" y="139" text-anchor="middle" fill="#b33" font-size="9" font-style="italic">α̃(t)</text>

  <!-- D ─ FF Torque -->
  <rect x="654" y="118" width="150" height="56" rx="4" fill="#fff5f4" stroke="#b33" stroke-width="1.6"/>
  <text x="729" y="141" text-anchor="middle" fill="#b33" font-size="11" font-weight="bold">τ<tspan font-size="9" dy="2">FF</tspan><tspan dy="-2"> = I</tspan><tspan font-size="9" dy="2">ax</tspan><tspan dy="-2">·α̃·ê</tspan></text>
  <text x="729" y="162" text-anchor="middle" fill="#777" font-size="8.5">I<tspan font-size="7" dy="2">zz</tspan><tspan dy="-2"> = 600 kg·m²</tspan></text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--       τ_FF drops from block D down to Σ summing junction    -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <line x1="729" y1="174" x2="729" y2="232" stroke="#b33" stroke-width="1.8"/>
  <line x1="729" y1="232" x2="622" y2="232" stroke="#b33" stroke-width="1.8"/>
  <line x1="622" y1="232" x2="622" y2="338" stroke="#b33" stroke-width="1.8" marker-end="url(#arr-r)"/>
  <text x="632" y="292" fill="#b33" font-size="10" font-style="italic">τ<tspan font-size="7" dy="2">FF</tspan></text>
  <text x="635" y="344" fill="#b33" font-size="10" font-weight="bold">+</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--    σ_ref branch from Traj Gen down to ⊖ error junction     -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <circle cx="525" cy="180" r="3" fill="#b33"/>
  <line x1="525" y1="180" x2="525" y2="226" stroke="#b33" stroke-width="1.3" stroke-dasharray="6,3"/>
  <line x1="525" y1="226" x2="128" y2="226" stroke="#b33" stroke-width="1.3" stroke-dasharray="6,3"/>

  <!-- MRP Convert (small annotation) -->
  <rect x="72" y="234" width="112" height="38" rx="3" fill="#fff5f4" stroke="#b33" stroke-width="1" stroke-dasharray="5,2"/>
  <text x="128" y="250" text-anchor="middle" fill="#b33" font-size="9" font-weight="bold">MRP Convert</text>
  <text x="128" y="264" text-anchor="middle" fill="#888" font-size="8" font-style="italic">σ = ê·tan(θ/4)</text>

  <line x1="128" y1="226" x2="128" y2="234" stroke="#b33" stroke-width="1.3" stroke-dasharray="6,3"/>
  <line x1="128" y1="272" x2="128" y2="350" stroke="#b33" stroke-width="1.3" stroke-dasharray="6,3"/>
  <line x1="128" y1="350" x2="155" y2="350" stroke="#b33" stroke-width="1.3" stroke-dasharray="6,3" marker-end="url(#arr-r)"/>
  <text x="82" y="218" fill="#b33" font-size="9" font-style="italic">θ(t),ω(t)</text>
  <text x="86" y="324" fill="#b33" font-size="9" font-style="italic">σ<tspan font-size="7" dy="2">ref</tspan><tspan dy="-2">,ω</tspan><tspan font-size="7" dy="2">ref</tspan></text>
  <text x="138" y="345" fill="#1558a8" font-size="9.5" font-weight="bold">+</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--                  FEEDBACK PATH  (y ≈ 355)                   -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- ⊖  Error Summing Junction -->
  <circle cx="172" cy="355" r="16" fill="#fff" stroke="#1558a8" stroke-width="2"/>
  <line x1="164" y1="355" x2="180" y2="355" stroke="#1558a8" stroke-width="1.4"/>
  <line x1="172" y1="347" x2="172" y2="363" stroke="#1558a8" stroke-width="1.4"/>

  <!-- ⊖ → Error block -->
  <line x1="188" y1="355" x2="232" y2="355" stroke="#1558a8" stroke-width="1.8" marker-end="url(#arr-b)"/>

  <!-- Error Computation -->
  <rect x="232" y="328" width="138" height="54" rx="4" fill="#edf1fa" stroke="#1558a8" stroke-width="1.5"/>
  <text x="301" y="348" text-anchor="middle" fill="#1558a8" font-size="10.5" font-weight="bold">MRP Error</text>
  <text x="301" y="364" text-anchor="middle" fill="#555" font-size="8.5" font-style="italic">σ<tspan font-size="7" dy="2">BR</tspan><tspan dy="-2"> = σ</tspan><tspan font-size="7" dy="2">BN</tspan><tspan dy="-2"> ⊖ σ</tspan><tspan font-size="7" dy="2">RN</tspan></text>
  <text x="301" y="377" text-anchor="middle" fill="#555" font-size="8.5" font-style="italic">ω<tspan font-size="7" dy="2">err</tspan><tspan dy="-2"> = ω</tspan><tspan font-size="7" dy="2">BN</tspan><tspan dy="-2"> − ω</tspan><tspan font-size="7" dy="2">ref</tspan></text>

  <!-- Error → Controller -->
  <line x1="370" y1="355" x2="420" y2="355" stroke="#1558a8" stroke-width="1.8" marker-end="url(#arr-b)"/>
  <text x="395" y="347" text-anchor="middle" fill="#1558a8" font-size="8.5" font-style="italic">σ<tspan font-size="6" dy="2">err</tspan><tspan dy="-2">,ω</tspan><tspan font-size="6" dy="2">err</tspan></text>

  <!-- F  Controller C(s) -->
  <rect x="420" y="322" width="160" height="66" rx="4" fill="#edf1fa" stroke="#1558a8" stroke-width="1.8"/>
  <text x="500" y="345" text-anchor="middle" fill="#1558a8" font-size="11.5" font-weight="bold">Controller C(s)</text>
  <text x="500" y="363" text-anchor="middle" fill="#444" font-size="10" font-style="italic">−K·σ<tspan font-size="7" dy="2">err</tspan><tspan dy="-2"> − P·ω</tspan><tspan font-size="7" dy="2">err</tspan></text>
  <text x="500" y="381" text-anchor="middle" fill="#888" font-size="8">see options below</text>

  <!-- Controller → Σ -->
  <line x1="580" y1="355" x2="606" y2="355" stroke="#1558a8" stroke-width="1.8" marker-end="url(#arr-b)"/>
  <text x="593" y="347" fill="#1558a8" font-size="9" font-style="italic">τ<tspan font-size="7" dy="2">FB</tspan></text>
  <text x="605" y="367" fill="#1558a8" font-size="9.5" font-weight="bold">+</text>

  <!-- Σ  Torque Summing Junction -->
  <circle cx="622" cy="355" r="16" fill="#fff" stroke="#1a1a2e" stroke-width="2"/>
  <line x1="614" y1="355" x2="630" y2="355" stroke="#1a1a2e" stroke-width="1.4"/>
  <line x1="622" y1="347" x2="622" y2="363" stroke="#1a1a2e" stroke-width="1.4"/>

  <!-- Σ → RW Map -->
  <line x1="638" y1="355" x2="692" y2="355" stroke="#1a1a2e" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="665" y="347" text-anchor="middle" fill="#333" font-size="9" font-style="italic">τ<tspan font-size="7" dy="2">body</tspan></text>

  <!-- G  RW Mapping -->
  <rect x="692" y="328" width="142" height="54" rx="4" fill="#fef3e6" stroke="#c67700" stroke-width="1.5"/>
  <text x="763" y="348" text-anchor="middle" fill="#c67700" font-size="10.5" font-weight="bold">RW Mapping</text>
  <text x="763" y="364" text-anchor="middle" fill="#555" font-size="8.5" font-style="italic">u = −G<tspan font-size="6" dy="2">s</tspan><tspan font-size="5" dy="-4">†</tspan><tspan dy="2">·τ</tspan><tspan font-size="7" dy="2">body</tspan></text>
  <text x="763" y="377" text-anchor="middle" fill="#888" font-size="8">clip ± 0.2 Nm</text>

  <!-- RW Map → RWs -->
  <line x1="834" y1="355" x2="888" y2="355" stroke="#1a1a2e" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="861" y="347" text-anchor="middle" fill="#333" font-size="9" font-style="italic">u<tspan font-size="7" dy="2">RW</tspan></text>

  <!-- H  Reaction Wheels -->
  <rect x="888" y="328" width="130" height="54" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.6"/>
  <text x="953" y="348" text-anchor="middle" fill="#2e7d32" font-size="10.5" font-weight="bold">Reaction</text>
  <text x="953" y="364" text-anchor="middle" fill="#2e7d32" font-size="10.5" font-weight="bold">Wheels ×3</text>
  <text x="953" y="377" text-anchor="middle" fill="#888" font-size="8" font-style="italic">τ = −G<tspan font-size="6" dy="2">s</tspan><tspan dy="-2">·u</tspan><tspan font-size="7" dy="2">RW</tspan></text>

  <!-- RWs → Plant -->
  <line x1="1018" y1="355" x2="1074" y2="355" stroke="#2e7d32" stroke-width="1.8" marker-end="url(#arr-g)"/>
  <text x="1046" y="347" text-anchor="middle" fill="#2e7d32" font-size="8.5" font-style="italic">τ<tspan font-size="6" dy="2">app</tspan></text>

  <!-- I  PLANT -->
  <rect x="1074" y="314" width="220" height="82" rx="5" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="1184" y="338" text-anchor="middle" fill="#2e7d32" font-size="11.5" font-weight="bold">Spacecraft Plant</text>
  <line x1="1084" y1="346" x2="1284" y2="346" stroke="#2e7d32" stroke-width="0.4" opacity="0.5"/>
  <text x="1184" y="362" text-anchor="middle" fill="#444" font-size="10" font-style="italic">I·ω̇ + ω×(I·ω) = τ</text>
  <text x="1184" y="378" text-anchor="middle" fill="#444" font-size="10" font-style="italic">σ̇ = ¼ B(σ)·ω</text>
  <text x="1184" y="392" text-anchor="middle" fill="#888" font-size="8">rigid body + flex solar arrays</text>

  <!-- Plant → output -->
  <line x1="1294" y1="355" x2="1360" y2="355" stroke="#2e7d32" stroke-width="1.8" marker-end="url(#arr-g)"/>
  <circle cx="1360" cy="355" r="4" fill="#2e7d32"/>
  <text x="1372" y="348" fill="#2e7d32" font-size="9.5" font-style="italic">σ<tspan font-size="7" dy="2">BN</tspan></text>
  <text x="1372" y="364" fill="#2e7d32" font-size="9.5" font-style="italic">ω<tspan font-size="7" dy="2">BN</tspan></text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--            DISTURBANCE d_ext → Σ (from below)               -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="580" y="400" width="84" height="32" rx="3" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1.1" stroke-dasharray="5,2"/>
  <text x="622" y="418" text-anchor="middle" fill="#7b1fa2" font-size="9" font-weight="bold">d<tspan font-size="7" dy="2">ext</tspan></text>
  <text x="622" y="428" text-anchor="middle" fill="#7b1fa2" font-size="7.5">bias/sine</text>
  <line x1="622" y1="400" x2="622" y2="371" stroke="#7b1fa2" stroke-width="1.2" stroke-dasharray="5,2" marker-end="url(#arr-p)"/>
  <text x="614" y="384" fill="#7b1fa2" font-size="9" font-weight="bold">+</text>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--              SENSOR FEEDBACK RETURN PATH                    -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <!-- Plant output → down -->
  <line x1="1360" y1="359" x2="1360" y2="468" stroke="#c67700" stroke-width="1.6"/>

  <!-- Sensors block -->
  <rect x="1100" y="448" width="160" height="42" rx="4" fill="#fff8e1" stroke="#c67700" stroke-width="1.4"/>
  <text x="1180" y="466" text-anchor="middle" fill="#c67700" font-size="10" font-weight="bold">Sensors (Nav)</text>
  <text x="1180" y="480" text-anchor="middle" fill="#888" font-size="8.5">σ<tspan font-size="6" dy="2">BN</tspan><tspan dy="-2">, ω</tspan><tspan font-size="6" dy="2">BN</tspan><tspan dy="-2"> + noise</tspan></text>

  <!-- output → Sensors -->
  <line x1="1360" y1="468" x2="1260" y2="468" stroke="#c67700" stroke-width="1.6" marker-end="url(#arr-o)"/>

  <!-- Sensors → long return line left → up to ⊖ -->
  <line x1="1100" y1="468" x2="172" y2="468" stroke="#c67700" stroke-width="1.6"/>
  <line x1="172" y1="468" x2="172" y2="371" stroke="#c67700" stroke-width="1.6" marker-end="url(#arr-o)"/>
  <text x="180" y="378" fill="#c67700" font-size="9" font-weight="bold">−</text>

  <!-- Return line label -->
  <text x="630" y="463" text-anchor="middle" fill="#c67700" font-size="9.5" font-style="italic">σ<tspan font-size="7" dy="2">BN</tspan><tspan dy="-2">(meas),  ω</tspan><tspan font-size="7" dy="2">BN</tspan><tspan dy="-2">(meas)    ──  feedback measurement  ──</tspan></text>

  <!-- Sensor noise annotation -->
  <rect x="1000" y="492" width="98" height="26" rx="3" fill="#fff8e1" stroke="#c67700" stroke-width="0.8" stroke-dasharray="4,2"/>
  <text x="1040" y="509" text-anchor="middle" fill="#c67700" font-size="8">sensor noise</text>
  <line x1="1040" y1="492" x2="1040" y2="472" stroke="#c67700" stroke-width="0.8" stroke-dasharray="3,2" marker-end="url(#arr-o)"/>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--             CONTROLLER DETAIL PANEL (below)                 -->
  <!-- ═══════════════════════════════════════════════════════════ -->

  <text x="40" y="548" fill="#1558a8" font-size="11.5" font-weight="bold" opacity="0.85">CONTROLLER OPTIONS  (selectable in C(s))</text>
  <line x1="500" y1="388" x2="500" y2="558" stroke="#1558a8" stroke-width="0.8" stroke-dasharray="4,3" opacity="0.35"/>

  <!-- Option 1: Standard PD -->
  <g transform="translate(40, 562)">
    <rect x="0" y="0" width="280" height="112" rx="4" fill="#fff" stroke="#1558a8" stroke-width="1.3"/>
    <rect x="0" y="0" width="280" height="24" rx="4" fill="#1558a8"/><rect x="0" y="12" width="280" height="12" fill="#1558a8"/>
    <text x="140" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">① Standard MRP-PD (+opt. I)</text>
    <text x="140" y="46" text-anchor="middle" fill="#333" font-size="11" font-style="italic" font-weight="bold">τ = −K·σ<tspan font-size="7" dy="2">err</tspan><tspan dy="-2"> − P·ω</tspan><tspan font-size="7" dy="2">err</tspan></text>
    <line x1="10" y1="54" x2="270" y2="54" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="72" fill="#444" font-size="9.5" font-style="italic">C(s) = 4Ps + K</text>
    <text x="16" y="88" fill="#444" font-size="9.5" font-style="italic">PID: C(s) = (4Ps²+Ks+K<tspan font-size="7" dy="2">i</tspan><tspan dy="-2">)/s</tspan></text>
    <text x="16" y="106" fill="#888" font-size="8.5">ω<tspan font-size="6" dy="2">n</tspan><tspan dy="-2">=√(K/4I),  ζ=P/√(KI)</tspan></text>
  </g>

  <!-- Option 2: Filtered PD -->
  <g transform="translate(345, 562)">
    <rect x="0" y="0" width="280" height="112" rx="4" fill="#fff" stroke="#1558a8" stroke-width="1.3"/>
    <rect x="0" y="0" width="280" height="24" rx="4" fill="#1558a8"/><rect x="0" y="12" width="280" height="12" fill="#1558a8"/>
    <text x="140" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">② Filtered Derivative PD</text>
    <text x="140" y="46" text-anchor="middle" fill="#333" font-size="11" font-style="italic" font-weight="bold">τ = −K·σ<tspan font-size="7" dy="2">err</tspan><tspan dy="-2"> − P·LPF{ω</tspan><tspan font-size="7" dy="2">err</tspan><tspan dy="-2">}</tspan></text>
    <line x1="10" y1="54" x2="270" y2="54" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="72" fill="#444" font-size="9.5" font-style="italic">C(s) = K + 4Ps/(τ<tspan font-size="7" dy="2">f</tspan><tspan dy="-2">·s+1)</tspan></text>
    <line x1="10" y1="80" x2="270" y2="80" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="96" fill="#888" font-size="8.5">τ<tspan font-size="6" dy="2">f</tspan><tspan dy="-2">=1/(2πf</tspan><tspan font-size="6" dy="2">c</tspan><tspan dy="-2">),  f</tspan><tspan font-size="6" dy="2">c</tspan><tspan dy="-2">=8 Hz  (above BW, below flex)</tspan></text>
    <text x="16" y="108" fill="#888" font-size="8.5">P boosted ×1.5 to offset filter attenuation</text>
  </g>

  <!-- Option 3: Notch PD -->
  <g transform="translate(650, 562)">
    <rect x="0" y="0" width="280" height="112" rx="4" fill="#fff" stroke="#1558a8" stroke-width="1.3"/>
    <rect x="0" y="0" width="280" height="24" rx="4" fill="#1558a8"/><rect x="0" y="12" width="280" height="12" fill="#1558a8"/>
    <text x="140" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">③ Notch Filter PD</text>
    <text x="140" y="46" text-anchor="middle" fill="#333" font-size="11" font-style="italic" font-weight="bold">τ = −K·σ<tspan font-size="7" dy="2">err</tspan><tspan dy="-2"> − P·Π H</tspan><tspan font-size="7" dy="2">n,i</tspan><tspan dy="-2">{ω</tspan><tspan font-size="7" dy="2">err</tspan><tspan dy="-2">}</tspan></text>
    <line x1="10" y1="54" x2="270" y2="54" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="72" fill="#444" font-size="9.5" font-style="italic">H<tspan font-size="7" dy="2">n</tspan><tspan dy="-2">=(s²+2ζ</tspan><tspan font-size="6" dy="2">z</tspan><tspan dy="-2">ωs+ω²)/(s²+2ζ</tspan><tspan font-size="6" dy="2">p</tspan><tspan dy="-2">ωs+ω²)</tspan></text>
    <line x1="10" y1="80" x2="270" y2="80" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="96" fill="#888" font-size="8.5">−20 dB depth at each modal frequency</text>
    <text x="16" y="108" fill="#888" font-size="8.5">ζ<tspan font-size="6" dy="2">z</tspan><tspan dy="-2">=0.05 (depth), ζ</tspan><tspan font-size="6" dy="2">p</tspan><tspan dy="-2">=0.3 (width)</tspan></text>
  </g>

  <!-- Plant detail -->
  <g transform="translate(968, 562)">
    <rect x="0" y="0" width="252" height="112" rx="4" fill="#fff" stroke="#2e7d32" stroke-width="1.3"/>
    <rect x="0" y="0" width="252" height="24" rx="4" fill="#2e7d32"/><rect x="0" y="12" width="252" height="12" fill="#2e7d32"/>
    <text x="126" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">Plant Model Detail</text>
    <text x="16" y="42" fill="#333" font-size="9.5" font-weight="bold">Rigid (linearized):</text>
    <text x="16" y="58" fill="#444" font-size="9.5" font-style="italic">G<tspan font-size="6" dy="2">rigid</tspan><tspan dy="-2">(s) = 1/(4I·s²)</tspan></text>
    <line x1="10" y1="64" x2="242" y2="64" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="80" fill="#333" font-size="9.5" font-weight="bold">With flex coupling:</text>
    <text x="16" y="96" fill="#444" font-size="9.5" font-style="italic">G = G<tspan font-size="6" dy="2">rig</tspan><tspan dy="-2"> + Σ g</tspan><tspan font-size="6" dy="2">i</tspan><tspan dy="-2">/(s²+2ζ</tspan><tspan font-size="6" dy="2">i</tspan><tspan dy="-2">ω</tspan><tspan font-size="6" dy="2">i</tspan><tspan dy="-2">s+ω²</tspan><tspan font-size="6" dy="2">i</tspan><tspan dy="-2">)</tspan></text>
    <text x="16" y="109" fill="#888" font-size="8.5">I=diag(900,800,600), bending+torsion modes</text>
  </g>

  <!-- Gain design -->
  <g transform="translate(1258, 562)">
    <rect x="0" y="0" width="230" height="112" rx="4" fill="#fff" stroke="#555" stroke-width="1"/>
    <rect x="0" y="0" width="230" height="24" rx="4" fill="#555"/><rect x="0" y="12" width="230" height="12" fill="#555"/>
    <text x="115" y="17" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">Gain Design</text>
    <text x="16" y="42" fill="#444" font-size="9.5">f<tspan font-size="6" dy="2">BW</tspan><tspan dy="-2"> = f</tspan><tspan font-size="6" dy="2">mode1</tspan><tspan dy="-2">/2.5,  ζ = 0.90</tspan></text>
    <line x1="10" y1="50" x2="220" y2="50" stroke="#dde" stroke-width="0.5"/>
    <text x="16" y="68" fill="#444" font-size="10" font-style="italic">K = 4·ω<tspan font-size="7" dy="2">n</tspan><tspan dy="-2">²·I</tspan><tspan font-size="7" dy="2">zz</tspan></text>
    <text x="16" y="86" fill="#444" font-size="10" font-style="italic">P = 2·ζ·ω<tspan font-size="7" dy="2">n</tspan><tspan dy="-2">·I</tspan><tspan font-size="7" dy="2">zz</tspan></text>
    <text x="16" y="105" fill="#888" font-size="8.5">Open loop: L(s) = G(s)·C(s)</text>
  </g>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--                     LEGEND (top right)                      -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <g transform="translate(1288, 86)">
    <rect x="0" y="0" width="310" height="62" rx="4" fill="#fff" stroke="#bbc" stroke-width="0.8"/>
    <text x="10" y="15" fill="#444" font-size="9.5" font-weight="bold">SIGNAL LEGEND</text>
    <line x1="40" y1="26" x2="68" y2="26" stroke="#b33" stroke-width="2"/><text x="74" y="30" fill="#555" font-size="8.5">Feedforward</text>
    <line x1="148" y1="26" x2="176" y2="26" stroke="#1558a8" stroke-width="2"/><text x="182" y="30" fill="#555" font-size="8.5">Feedback</text>
    <line x1="238" y1="26" x2="266" y2="26" stroke="#2e7d32" stroke-width="2"/><text x="272" y="30" fill="#555" font-size="8.5">Plant</text>
    <line x1="40" y1="44" x2="68" y2="44" stroke="#c67700" stroke-width="2"/><text x="74" y="48" fill="#555" font-size="8.5">Sensor return</text>
    <line x1="148" y1="44" x2="176" y2="44" stroke="#b33" stroke-width="1.2" stroke-dasharray="6,3"/><text x="182" y="48" fill="#555" font-size="8.5">Reference</text>
    <line x1="238" y1="44" x2="266" y2="44" stroke="#7b1fa2" stroke-width="1.2" stroke-dasharray="5,2"/><text x="272" y="48" fill="#555" font-size="8.5">Disturbance</text>
  </g>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--                     MISSION TIMELINE                        -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 714)">
    <text x="0" y="0" fill="#333" font-size="11" font-weight="bold">MISSION TIMELINE</text>
    <rect x="0" y="12" width="1556" height="6" rx="3" fill="#e0e0e0"/>
    <rect x="0" y="12" width="520" height="6" rx="3" fill="#b33" opacity="0.35"/>
    <rect x="0" y="12" width="520" height="6" rx="3" fill="#1558a8" opacity="0.2"/>
    <rect x="520" y="12" width="1036" height="6" rx="3" fill="#2e7d32" opacity="0.28"/>
    <line x1="0" y1="8" x2="0" y2="22" stroke="#444" stroke-width="1.2"/>
    <text x="0" y="34" fill="#444" font-size="9" text-anchor="middle">t=0</text>
    <line x1="520" y1="6" x2="520" y2="22" stroke="#b33" stroke-width="1.8"/>
    <text x="520" y="34" fill="#b33" font-size="9" text-anchor="middle" font-weight="bold">T<tspan font-size="7" dy="2">slew</tspan><tspan dy="-2">≈30s</tspan></text>
    <line x1="1556" y1="8" x2="1556" y2="22" stroke="#444" stroke-width="1.2"/>
    <text x="1556" y="34" fill="#444" font-size="9" text-anchor="middle">90s</text>
    <text x="260" y="50" text-anchor="middle" fill="#b33" font-size="10" font-weight="bold">Phase 1: FF + FB (Trajectory Tracking)</text>
    <text x="1038" y="50" text-anchor="middle" fill="#2e7d32" font-size="10" font-weight="bold">Phase 2: FB Only (Fine Pointing)</text>
  </g>

  <!-- ═══════════════════════════════════════════════════════════ -->
  <!--                  KEY EQUATIONS &amp; NOTES                      -->
  <!-- ═══════════════════════════════════════════════════════════ -->
  <rect x="0" y="784" width="1640" height="1" fill="#1a1a2e" opacity="0.12"/>
  <g transform="translate(40, 800)">
    <text x="0" y="14" fill="#333" font-size="10.5" font-weight="bold">Key Equations</text>
    <text x="0" y="32" fill="#444" font-size="9.5">Combined: τ<tspan font-size="7" dy="2">body</tspan><tspan dy="-2"> = τ</tspan><tspan font-size="7" dy="2">FF</tspan><tspan dy="-2">(t) + τ</tspan><tspan font-size="7" dy="2">FB</tspan><tspan dy="-2">(σ,ω,t) + d</tspan><tspan font-size="7" dy="2">ext</tspan></text>
    <text x="0" y="48" fill="#444" font-size="9.5">Feedback: τ<tspan font-size="7" dy="2">FB</tspan><tspan dy="-2"> = −K·σ</tspan><tspan font-size="7" dy="2">BR</tspan><tspan dy="-2"> − P·ω</tspan><tspan font-size="7" dy="2">err</tspan><tspan dy="-2">       RW: u</tspan><tspan font-size="7" dy="2">RW</tspan><tspan dy="-2"> = clip(−G</tspan><tspan font-size="7" dy="2">s</tspan><tspan font-size="5" dy="-4">†</tspan><tspan dy="2">·τ, ±0.2Nm)</tspan></text>
  </g>
  <g transform="translate(490, 800)">
    <text x="0" y="14" fill="#333" font-size="10.5" font-weight="bold">Signal Flow</text>
    <text x="0" y="32" fill="#b33" font-size="9.5">FF: θ<tspan font-size="7" dy="2">cmd</tspan><tspan dy="-2"> → Traj → Shaper → I·α̃·ê → τ</tspan><tspan font-size="7" dy="2">FF</tspan></text>
    <text x="0" y="48" fill="#1558a8" font-size="9.5">FB: (σ<tspan font-size="7" dy="2">ref</tspan><tspan dy="-2">−σ</tspan><tspan font-size="7" dy="2">meas</tspan><tspan dy="-2">) → C(s) → τ</tspan><tspan font-size="7" dy="2">FB</tspan><tspan dy="-2">     Sum: τ</tspan><tspan font-size="7" dy="2">FF</tspan><tspan dy="-2">+τ</tspan><tspan font-size="7" dy="2">FB</tspan><tspan dy="-2"> → G</tspan><tspan font-size="7" dy="2">s</tspan><tspan font-size="5" dy="-4">†</tspan><tspan dy="2"> → RWs → Plant → (σ,ω)</tspan></text>
  </g>
  <g transform="translate(1070, 800)">
    <text x="0" y="14" fill="#333" font-size="10.5" font-weight="bold">G<tspan font-size="8" dy="2">s</tspan><tspan dy="-2"> Matrix</tspan></text>
    <text x="0" y="32" fill="#444" font-size="9.5" font-family="'Courier New',monospace">⎡√2/2  −√2/2  0⎤</text>
    <text x="0" y="46" fill="#444" font-size="9.5" font-family="'Courier New',monospace">⎢√2/2   √2/2  0⎥</text>
    <text x="0" y="60" fill="#444" font-size="9.5" font-family="'Courier New',monospace">⎣ 0      0    1⎦</text>
  </g>
  <g transform="translate(1360, 800)">
    <text x="0" y="14" fill="#333" font-size="10.5" font-weight="bold">Source Modules</text>
    <text x="0" y="32" fill="#b33" font-size="9.5">feedforward_control.py</text>
    <text x="0" y="48" fill="#1558a8" font-size="9.5">feedback_control.py</text>
    <text x="0" y="64" fill="#2e7d32" font-size="9.5">run_vizard_demo.py</text>
  </g>

  <!-- BORDER -->
  <rect x="1" y="1" width="1638" height="868" fill="none" stroke="#1a1a2e" stroke-width="1.5" rx="2"/>
</svg>
</div>
</body>
</html>
